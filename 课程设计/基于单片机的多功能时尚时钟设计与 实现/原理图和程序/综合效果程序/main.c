
#include "task.h"

bit BIT_10MS;

extern void OS_ALLRun(void);
extern void start(void);

/*********************************************************************************************************
** ║»╩§├ч│к: init
** ╣д─▄├У╩Ш: │ш╩╝╗»│╠лЫ,┤╦┤д░Ч║гХе╩▒кэ0Аб┤«лл┐┌│ш╩╝╗»
** ╩САААА╚в: ╬я
** ╩САААА│Ш: ╬я
** ╚ФЙо▒С┴┐: ╬я
** хэМ├─Б┐ж: 
  **
** ОэААААН▀: 
** ╚НААААк┌: 
**-------------------------------------------------------------------------------------------------------
** ля И─ ╚╦:
** ╚НААААк┌:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/
void init()
{
    
	//"¤х═││ш╩╝╗»"
	//IE = 0x00;      //"Кт│§олХ¤"
	EA = 1;			//О▄олХ¤
	//ES = 1;         //4"┤«ллолХ¤н╩ль"
	//EX0 = 1;        //0"═Р▓┐олХ¤0н╩ль"
	//ET0 = 1;        //1"Хе╩▒кэ0олХ¤н╩ль"
	//EX1 = 1;        //2"═Р▓┐олХ¤1н╩ль"
	//ET1 = 1;        //3"Хе╩▒кэ1олХ¤н╩ль"
	//ET2 = 1;
	//IP = 0;         //"Кт│§олХ¤М┼¤╚╝Х"
	//PS = 1;         //"┤«ллолХ¤М┼¤╚"
	//PX0 = 1;        //"═Р▓┐олХ¤0"
	//PT0 = 1;        //"Хе╩▒кэолХ¤0"
	//PX1 = 1;        //"═Р▓┐олХ¤1"
	//PT1 = 0;        //"Хе╩▒кэолХ¤1"
	//TCON--------     "Хе╩▒кэ┐пок╝─┤Ткэ",   TF1 | TR1 | TF0 | TR0 | IE1 | IT1 | IE0 | IT0
	//TCON = 0;
	//TF1             "T1му│Ш▒ЖоЙ"
	//TR1 = 1;        //"T1н╦лл┐пок"
	//TF0             "T0му│Ш▒ЖоЙ"
	//TR0 = 1;        //"T0н╦лл┐пок"
	//IE1             "═Р▓┐олХ¤1╔ЖКв▒ЖоЙ"
	//IT1 = 1;        //"═Р▓┐олХ¤1┤Цибий╩й 0=хукй 1=▒▀Лп"
	//IE0             "═Р▓┐олХ¤0╔ЖКв▒ЖоЙ"
	//IT0 = 1;        //"═Р▓┐олХ¤0┤Цибий╩й 0=хукй 1=▒▀Лп"
	//TMOD--------    "Хе╩▒кэ─Б╩й┐пок╝─┤Ткэ"
	//  | GATE   | C//T   | M0     | M1    | GATE   | C//T   | M0       | M1        |
	//"И▀4╬╗М├М┌T1  х═4╬╗М├М┌T0"
	//TMOD = 0x21;
	//SCON  "┤«лл┐пок"
	//| SM0 | SM1 | SM2 | REN | TB8 | RB8 | TI  | RI  |
	//"| SM0  SM1 | ╣цОэий╩й  |   ╦х    ├э   |   ▓е ╠п ┬╩    |"
	//"|   0    0 | ий ╩й 0   |┤  ═г▓ймк╬╗   |   fosc/12     |"
	//"|   0    1 | ий ╩й 1   | 10╬╗мВ▓й╩Ниб |  Хе╩▒кэ┐пок   |"
	//"|   1    0 | ий ╩й 2   | 11╬╗мВ▓й╩Ниб |fosc/32|fosc/64|"
	//"|   1    1 | ий ╩й 3   | 11╬╗мВ▓й╩Ниб |  Хе╩▒кэ┐пок   |"
	//"SM2 ХЯ╗Щ═еЛХн╩ль"
	//"REN йМ╩Нн╩ль┐пок"
	//"TB8 иб╦═╩§ЙПх┌9╬╗"
	//"RB8 йМ╩Н╩§ЙПх┌9╬╗"
	//"TI  иб╦═олХ¤▒ЖоЙ"
	//"RI  йМ╩▄олХ¤▒ЖоЙ"
	//SCON = 0x50;
	//PCON "хун┤┐пок╝─┤Ткэ"
	//SMOD"▓е╠п┬╩ЛАны╬╗ =1 ий╩й1,2,3 ▓е╠п┬╩╝М▒Х"
	//"▓е╠п┬╩=2^(sod)*fosc/(32*12*(256-│шох))"
    //T2CON = 0x0;
    //TR2 = 1;
    //ET2 = 1;
//-----------олћЯ│ш╩╝╗»-------------------------------------------------  BELL
//INT0 init		  
#ifdef EN_OS_INT0
    IT0 = 1;    //═Р▓┐олХ¤╬ф▒▀Лп┤Циб
    EX0 = 1;    //н╩ль═Р▓┐олХ¤
	
#endif

 

  #ifdef EN_OS_INT1
//	PX1 = 1;    //"═Р▓┐олХ¤1"
    IT1 = 1;    //═Р▓┐олХ¤╬ф▒▀Лп┤Циб
    EX1 = 1;    //н╩ль═Р▓┐олХ¤ 
  #endif  	
  
    
#ifdef EN_OS_SERIAL
    SCON = 0x50;
    //TMOD|= 0x20;
	BRT	   = 0xfb;  //0xfb: 18.432MHz,12T,SMOD=0,9600bps
	AUXR   |= 0x11;	// ╩╣М├Х└┴б▓е╠п┬╩иб╔Щкэ
   /* TH1  = 0xFB;
    TL1  = 0xFB;
    TR1  = 1; */
  //  ES   = 1;       //н╩нS┤«┐┌олћЯ
   // PS = 1;         //"┤«ллолХ¤М┼¤╚"
   // PSH;
#endif

#ifdef EN_OS_TIMER0
/****************Хе╩▒кэ0│ш╩╝╗»****************/
  TMOD|=0X01;
  	ET0=1; 
 	TH0 = 0x0FD; //400us
    TL0 = 0x9A;
	IPH=0X09; 	 
#endif
/****************Хе╩▒кэ1│ш╩╝╗»****************/
#ifdef EN_OS_TIMER1
     TMOD|=0X20;//8╬╗ОнХ»опнп─Б╩й 
  	 ET1=1;  //Хе╩▒кэ0┐фолХ¤
     TH1=0x00;//Хе╩▒160us ЙДНы18.432M
     TL1=0x00;
#endif
/***************************/
#ifdef EN_OS_UART2	 

	S2CON  = 0x50;  //0101,0000 8╬╗┐╔▒С▓е╠п┬╩Бг╬якТ┼╝лБЛж╬╗,н╩льйМ╩Н
	BRT	   = 0xfb;  //0xfb: 18.432MHz,12T,SMOD=0,9600bps
	AUXR   |= 0x11;  //T0x12,T1x12,UART_M0x6,BRTR,S2SMOD,BRTx12,EXTRAM,S1BRS	
	IE2	    = 0x01;	//н╩ль┤«┐┌2олХ¤,ES2=1
#endif

/***/
#ifdef EN_OS_PCA0  //М├М┌16╬╗Хе╩▒

    CMOD = 0x80;   	 //12иокх
    CCON = 0x00;   //КтолХ¤▒ЖоЙ
    CL = 0;
    CH = 0;
	CCAP0H = 0xEF; //40msХе╩▒
    CCAP0L = 0xD8;  
	CCAPM0 = 0x49; //╔Уо├PCA0╬ф16╬╗Хе╩▒кэБгн╩льPCA─Б┐ж0олХ¤
	//CR=1; //кЗХ»PCA╝к╩§
#endif
/*******************************************/
#ifdef EN_OS_PCA1	  //М├М┌16╬╗Хе╩▒

    CMOD = 0x80;   	 //12иокх
	CCON = 0x00;   //КтолХ¤▒ЖоЙ    
    CL = 0;
    CH = 0;  
    CCAP1H =0x01;
    CCAP1L =0x68;	//usХе╩▒
	//CCAPM1 = 0x49;  н╩льPCA─Б┐ж1олХ¤ 

#endif
/***********************************************************************/
}
/*********************************************************************************************************
** ║»╩§├ч│к: main
** ╣д─▄├У╩Ш: оэ║»╩§БгМ├╗Д│╠лЫ┤МНР└№о┤лл
** ╩САААА╚в: ╬я
** ╩САААА│Ш: ╬я
** ╚ФЙо▒С┴┐: ╬я
** хэМ├─Б┐ж: init()
**
** ОэААААН▀:
** ╚НААААк┌: 
**-------------------------------------------------------------------------------------------------------
** ля И─ ╚╦:
** ╚НААААк┌:
**------------------------------------------------------------------------------------------------------
********************************************************************************************************/

void main(void)
{
    init();
	start();
				    
	while(1)
	{
       OS_ALLRun();
    }
 }
 /*********************************************************************************/
/*************************************************************************************
************************************************************************************
***********************                                     ***************************
***********************    http://59tiaoba.taobao.com       ***************************
***********************                                     ***************************
********************************│╠лЫ▒Ял┤Б║Fucp****************************************
**********************************************************************************/